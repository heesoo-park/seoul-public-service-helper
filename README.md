# 🏙 서울 공공서비스 도우미

**🎉근처에 있지만 알지 못했던 다양한 공공서비스를 확인하고 즐겨보세요🎉**

## 👨‍💻 프로젝트 소개
<p align="center">
  <img src="https://github.com/heesoo-park/seoul-public-service-helper/assets/80674868/0ccc276e-44b1-4ba6-af7a-368f6263bb59" width="30%" height="30%">
  <img src="https://github.com/heesoo-park/seoul-public-service-helper/assets/80674868/0f3dbe3a-4980-4c0d-a20d-6e172b4d1bd4" width="30%" height="30%">
  <img src="https://github.com/heesoo-park/seoul-public-service-helper/assets/80674868/7c20cbe9-45f9-4f38-abfd-cae491d99d76" width="30%" height="30%">
  <img src="https://github.com/heesoo-park/seoul-public-service-helper/assets/80674868/b0b68bf8-84d9-4e55-ae68-42d13703b238" width="30%" height="30%">
  <img src="https://github.com/heesoo-park/seoul-public-service-helper/assets/80674868/84ee04b7-8591-4578-9bbb-0d6c6a227f69" width="30%" height="30%">
  <img src="https://github.com/heesoo-park/seoul-public-service-helper/assets/80674868/b7c1504a-384e-4573-9fb4-47d62f530cc3" width="30%" height="30%">
</p>

### 내배캠 Android 트랙 최종 프로젝트

> 누구나 간편하게 서울시에서 제공하는 다양한 공공서비스에서 필요로 하는 공공서비스를 찾아보고, 정보를 확인하면서 예약하는데 도움을 받을 수 있는 앱입니다. 지역별로 찾아볼 수도 있고 지도를 이용해 찾아볼 수도 있으며 여러 키워드로 추천하는 공공서비스를 만나볼 수도 있습니다.

## 📌 주요 기능
#### ✔ 서울시 공공서비스 예약 정보 확인
- 앱 내의 여러 페이지에서 예약에 관련된 정보 제공
    - 요금, 서비스 대상, 예약 일자, 시간, 장소 등
- 전화나 외부 웹 사이트로 이동 가능
#### ✔ 관심 지역별 공공서비스 탐색
- 서울 지역구 중 최대 3개까지 관심 지역을 선택 및 메인 페이지에서 전환 가능
- 선택한 지역에 존재하는 공공서비스를 카테고리별로 정보 제공
- 키워드 검색을 통한 탐색 가능
#### ✔ 지도를 이용한 공공서비스 탐색
- 공공서비스 위치에 있는 마커를 통해 쉽게 위치 파악 가능
- 마커 클릭 시 나타나는 정보창으로 간단하게 정보 얻기 가능
- 다양한 필터링과 키워드 검색을 통한 탐색 가능
#### ✔ 공공서비스 저장
- 마음에 들거나 이용해보고 싶은 공공서비스 저장 가능
- 저장된 서비스에 대해서는 알림 서비스 진행
    - 예약 시작 하루 전, 예약 당일, 예약 마감 하루 전

## 📲 담당 기능
#### • 관심지역 설정 및 변경
SharedPreference, CheckBox, registerForActivityResult를 이용하여 구현

    <기능>
    1. 메인 페이지의 드롭다운 메뉴를 통한 관심지역 변경
    2. 관심지역 선택 페이지 이동
    3. 관심지역 선택 페이지를 통한 관심지역 리스트 재설정
    
#### • 저장한 공공서비스에 대한 알림
CoroutineWorker를 PeriodicWorkRequest로 만들고 WorkerManager에 enqueue하고 작업을 옵저빙하는 것으로 구현

    <기능>
    1. 1시간에 한 번씩 백그라운드에서 조건에 맞는 저장한 공공서비스가 있을 때 메인 페이지의 알림 UI 업데이트
    2. 알림 페이지에서 조건에 맞는 공공서비스 보여주기

#### • 공공서비스 랜덤 선택 배너
Room, DialogFragment, LocalDateTime, DateTimeFormatter를 이용하여 구현

    <기능>
    1. 배너를 클릭했을 때 오늘 기준 앞뒤 3일안에 예약을 시작했거나 시작할 공공서비스들 중 하나의 상세 페이지로 이동

#### • 지도 페이지 구성
Naver Map API 사용

    <기능>
    1. 맵, 마커, 현재 위치 사용
    2. 지도 위에 생성하는 마커를 통해 공공서비스 위치와 정보를 매칭시킴
    3. 현재 위치 기반으로 지도 위치를 잡아줌(서울 내부일 때는 사용자 현재 위치, 서울 외부일 때는 서울 시청을 중심으로 세팅)

#### • 필터링 & 검색
Room, SharedPreference, HashMap을 이용하여 구현

    <기능>
    1. 필터링 페이지에서 필터 옵션들을 선택하여 필터링 진행하고 실시간으로 결과 반영
    2. 선택한 필터 옵션을 지도 페이지에서 보여줌
    3. 여러 기준(카테고리, 전화번호 등)에서의 키워드 기반으로 검색 진행하고 실시간 결과 반영
    4. 다른 페이지 갔다가 돌아와도 필터링이나 검색의 결과 유지

#### • 마커 생성
Naver Map API 사용

    <기능>
    1. 대분류별 색상 지정
    2. 클릭 시 아이콘의 색상이 변경되고 카메라가 움직이며 간단하게 해당 위치의 공공서비스 정보를 볼 수 있는 마커 정보창 생성

#### • 마커 정보창 제작
ViewPager2, SharedPreference를 이용하여 구현

    <기능>
    1. 상세 정보창 이동, 저장, 공유, 외부 예약 웹 사이트 이동 가능
    2. 공공서비스 이름과 위치, 가격 정보 알 수 있음

#### • 가로 무한 스크롤
멀티뷰타입 리사이클러뷰, 고차함수, Coroutine, Room, ListAdapter를 이용하여 구현

    <기능>
    1. 왼쪽으로 스크롤을 계속 하면 현재 추천 키워드에 맞는 공공서비스가 없을 때까지 새로운 공공서비스가 5개씩 채워짐

#### • 후기 작성 & 삭제 & 수정
Firestore, Coroutine, ListAdapter를 이용하여 구현

    <기능>
    1. 한 공공서비스에 대해 사용자 당 하나의 후기를 작성할 수 있음
    2. 이미 후기를 작성했다면 수정하거나 삭제를 할 수 있음
    3. 작성 & 삭제 & 수정한 후기는 서버에 저장됨
    4. 앱 내부 캐시를 이용하여 빠르게 UI를 업데이트

#### • 사용자 신고
Firestore, 고차함수, SharedPreference, 공유 뷰모델, DialogFragment를 이용하여 구현

    <기능>
    1. 신고하려는 후기를 길게 누르면 신고 확인 창이 뜨고 확인을 누를 시 신고가 이루어짐
    2. 10회 이상 신고된 사용자는 서버 내 밴리스트에 들어가고 밴리스트에 들어가면 해당 사용자의 후기는 일반 사용자에게 보이지 않음(자신만 자신의 후기를 볼 수 있음)
    3. 한번 신고한 사용자는 다시 신고할 수 없음
    4. 자기 자신을 신고할 수 없음

#### • 서버에 데이터 저장 및 불러오기
멀티뷰타입 리사이클러뷰, 고차함수, Firestore, DialogFragment, 공유 뷰모델, SharedPreference를 이용하여 구현

    <기능>
    1. 설정 창에서 서버에 데이터 저장하기 버튼을 통해 자신의 이름, 저장한 공공서비스 리스트를 저장할 수 있고 이를 저장해놓은 위치의 키를 받을 수 있음
    2. 키를 입력하고 동기화하기 버튼을 누르면 서버에 저장되어있던 이름과 저장한 공공서비스 리스트가 현재 앱에 적용됨

#### • 앱 기반 구조 설정
BottomNavigationView와 ViewPager2의 조합으로 가장 기본 구조를 설정

    <기능>
    1. offset 조절을 통해 프래그먼트가 재생성되지 않음
    2. ViewPager2이지만 스와이프할 수 없음

#### • Firebase 환경 구축 및 연동
Firebase의 Firestore, Storage를 사용하기 위해 앱과 연결

    <기능>
    1. 사용자, 공공서비스, 후기, 밴리스트, 동기화 데이터를 Firestore에 저장
    2. 사용자 프로필 이미지 데이터를 Storage에 저장

#### • UI 디자인 총괄
Figma를 이용하여 와이어프레임을 그리고 이후 지속적인 수정을 진행

#### • 다크모드 호환
colors-night 패키지를 활용하여 진행
    
## ⚡ 트러블슈팅
* 로컬 캐시를 활용한 사용자 사용성 개선   
  * [Problem] 후기 기능에서 발생하는 지연시간   
  → 서버 통신 시간으로 인해 발생했지만 고정된 서버 통신 시간을 더 줄일 수 없었음   
  * [TroubleShooting] 로컬 캐시 활용(메모리 단에 저장되어있는 사용자 정보)   
  → 프로필 편집이 될 때마다 로컬 캐시 값 전체 갱신   
  → 서버 통신 요청과 동시에 먼저 로컬 캐시를 가지고 UI 업데이트 진행   
  → 서버에서 돌아온 데이터는 DiffUtil 클래스에 의해 처림(*같은 서비스ID를 가졌다면 덮어쓰고, 없는 데이터라면 새로 추가)

* 중복좌표 처리를 통한 지도 사용성 향상   
  * [Problem] Room에서 데이터들을 가져와 마커로 나타내는데 예상보다 개수가 적음   
  → 중복좌표인 경우에 가장 마지막에 있는 데이터가 마커를 차지하며 생기는 문제   
  → 사용자들이 한 장소에 있는 모든 공공서비스 접근이 불가능해짐   
  * [TroubleShooting] 해쉬맵과 뷰페이저2 사용   
    1) Room에서 넘어오는 데이터들의 좌표를 키로 하여 중복좌표 데이터들을 묶음   
        : HashMap<Pair<String, String>, List<ReservationEntity>>의 형태  
    2) 묶여진 데이터를 마커에 넣고 마커 클릭시 뷰페이저2의 어댑터로 넘김   
        : FragmentStateAdapter 대신 ListAdapter 사용   
    → 좌우 스와이프를 통해 좌표가 동일한 서비스들을 모두 볼 수 있게 됨   
  
## ❗ 느낀점
#### 배운 점😍
🎇 6주라는 시간 동안 한 팀으로 개발을 진행하는 방법   
👍 
 
🎇 팀장으로서의 역할   
👍 

🎇 기획 - 개발 - 배포 - 유지보수의 사이클   
👍 

🎇 Clean Architecture의 구조와 흐름을 알고 이를 앱에 적용하는 방법   
👍 

🎇 NoSQL DB인 Firestore를 활용하여 데이터를 저장하고 읽고 쿼리하는 방법   
👍 

🎇 Naver Map API를 이용하는 방법   
👍 

🎇 Room을 구성하고 쿼리를 만드는 방법   
👍 

🎇 Coil을 이용하여 현재 상태에 따라 sacleType과 이미지를 변경하는 방법   
👍 

#### 아쉬워요😢
💦 커스텀으로 UI를 만들다 보니 생기는 다양한 예외상황에 대한 처리   
🚩 

💦 Naver Map에서 중복좌표인 서비스들을 마커 하나에 포함시키는 방법   
🚩 

💦 멀티뷰타입 리사이클러뷰 안에 있는 리사이클러뷰의 무한 스크롤 기능 구현   
🚩 
 
💦 레포지토리에서 Firestore에 접근해서 값을 안전하게 반환받는 방법   
🚩 

💦 앱스토어 배포를 위한 비공개 유저 테스트와 심사 과정   
🚩 

💦 UI 디자인   
🚩 
